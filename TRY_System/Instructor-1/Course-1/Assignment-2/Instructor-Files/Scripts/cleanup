if [ -f secret ]; then
    echo `basename $0` phase started.
fi

. $WD_BACKPATH/funcs/path

if [ -s secret ]; then set -x; fi

if $LATE; then
    echo Your submission is saved in a separate location
    echo "  " reserved for late submissions.
fi

if [ ! -d "$savedir" ]; then
    mkdir $savedir
fi

if [ -f $savedir/${STUDENT}.zip ]; then
    mv $savedir/${STUDENT}.zip /tmp/old$$.zip
fi

if zip -qr $savedir/${STUDENT} * > /dev/null; then
    echo "The following files were saved:"
    zipinfo -1 $savedir/${STUDENT} | grep -v '^,'
else
    echo "Unable to archive your files."
    if [ -f /tmp/old$$.zip ]; then
        echo "Your previous submission is being restored."
        mv /tmp/old$$.zip $savedir/${STUDENT}.zip
    fi
    exit 1
fi

if [ -f /tmp/old$$.zip ]; then
    rm /tmp/old$$.zip
fi

if [ -f secret ]; then
    echo `basename $0` phase finished.
fi

